<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å€¾å¬å»ºè¨€ - æ ¡å›­é¡¹ç›®åŒ–ææ¡ˆç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .progress-bar { transition: width 0.5s ease-in-out; }
        .hidden { display: none; }
        .active-tab { border-bottom: 3px solid #3b82f6; color: #1d4ed8; font-weight: bold; }
    </style>
</head>
<body>

    <nav class="bg-white shadow-md fixed w-full z-10 top-0">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <i class="fa-solid fa-bullhorn text-blue-600 text-2xl mr-2"></i>
                    <span class="font-bold text-xl text-gray-800">å€¾å¬å»ºè¨€</span>
                </div>
                <div class="flex items-center space-x-8">
                    <button onclick="switchTab('public')" id="btn-public" class="h-16 px-2 active-tab flex items-center">
                        <i class="fa-solid fa-users-viewfinder mr-2"></i> å…¬ç¤ºä¸è¿½è¸ª (ä¸­å°)
                    </button>
                    <button onclick="switchTab('submit')" id="btn-submit" class="h-16 px-2 text-gray-500 hover:text-blue-600 flex items-center">
                        <i class="fa-solid fa-pen-to-square mr-2"></i> æˆ‘è¦å»ºè¨€ (å‰å°)
                    </button>
                    <button onclick="switchTab('admin')" id="btn-admin" class="h-16 px-2 text-gray-500 hover:text-blue-600 flex items-center">
                        <i class="fa-solid fa-screwdriver-wrench mr-2"></i> å·¥ä½œå°è´¦ (åå°)
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto mt-24 px-4 pb-12">

        <div id="view-public">
            <div class="bg-blue-600 rounded-xl p-8 text-white mb-8 shadow-lg">
                <h1 class="text-3xl font-bold mb-4">ä½ çš„å£°éŸ³ï¼Œæ­£åœ¨æ”¹å˜æ ¡å›­</h1>
                <div class="flex gap-4">
                    <input type="text" placeholder="åœ¨æäº¤å‰ï¼Œè¯·å…ˆæœç´¢æ˜¯å¦å·²æœ‰ç›¸å…³ææ¡ˆ..." class="w-full p-3 rounded-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-300">
                    <button class="bg-yellow-400 text-blue-900 font-bold px-6 py-3 rounded-lg hover:bg-yellow-300">æœç´¢</button>
                </div>
                <div class="mt-4 text-sm opacity-90">
                    ğŸ”¥ çƒ­é—¨è®®é¢˜ï¼š <span class="underline cursor-pointer ml-2">å›¾ä¹¦é¦†ç©ºè°ƒæ¸©åº¦</span> <span class="underline cursor-pointer ml-2">è¥¿åŒºé£Ÿå ‚ç‰©ä»·</span> <span class="underline cursor-pointer ml-2">å®¿èˆé—¨ç¦å»¶é•¿</span>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="public-cards">
                </div>
        </div>

        <div id="view-submit" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-8 max-w-3xl mx-auto border-t-4 border-blue-500">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">å‘èµ·ä¸€ä¸ªæ–°çš„ææ¡ˆ</h2>
                
                <form id="submission-form" action="https://docs.google.com/forms/u/0/d/e/1FAIpQLSek5RuI8EtXngkxOp1636_d3yJz_aSZxLRu0G7_VE2KOwi6pA/formResponse" target="no-target" method="POST">
                    
                    <div class="mb-4 p-4 bg-yellow-50 text-yellow-800 rounded-lg text-sm border border-yellow-200">
                        <i class="fa-solid fa-circle-info mr-1"></i> æ¸©é¦¨æç¤ºï¼šä¸ºäº†æé«˜è§£å†³æ•ˆç‡ï¼Œå»ºè®®å…ˆåœ¨å…¬ç¤ºåŒºæœç´¢ç›¸ä¼¼é—®é¢˜å¹¶ç‚¹å‡»â€œé™„è®®â€ã€‚
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-gray-700 font-bold mb-2">é—®é¢˜åˆ†ç±»</label>
                            <select class="w-full border rounded-lg p-3 bg-gray-50" name="entry.1486641009" required>
                                <option value="" disabled selected>è¯·é€‰æ‹©ä¸€ä¸ªç±»åˆ«</option>
                                <option value="åå‹¤ä¿éšœ">åå‹¤ä¿éšœ (é£Ÿå ‚/å®¿èˆ/ç»´ä¿®)</option>
                                <option value="æ•™å­¦æ•™åŠ¡">æ•™å­¦æ•™åŠ¡ (è¯¾ç¨‹/å›¾ä¹¦é¦†)</option>
                                <option value="ç”Ÿæ´»æƒç›Š">ç”Ÿæ´»æƒç›Š</option>
                                <option value="æ´»åŠ¨å»ºè®®">æ´»åŠ¨å»ºè®®</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-gray-700 font-bold mb-2">æ¶‰åŠåœ°ç‚¹</label>
                            <input type="text" class="w-full border rounded-lg p-3 bg-gray-50" placeholder="ä¾‹å¦‚ï¼šä¸‰é£Ÿå ‚äºŒæ¥¼" name="entry.71230980">
                        </div>
                    </div>

                    <div class="mb-6">
                        <label class="block text-gray-700 font-bold mb-2">è¯¦ç»†æè¿°</label>
                        <textarea class="w-full border rounded-lg p-3 bg-gray-50 h-32" placeholder="è¯·è¯¦ç»†æè¿°å®¢è§‚äº‹å®..." name="entry.1804237831" required></textarea>
                    </div>

                    <div class="mb-6">
                        <label class="block text-gray-700 font-bold mb-2 text-blue-600">ğŸ’¡ ä½ çš„å»ºè®®æ–¹æ¡ˆ (æ ¸å¿ƒ)</label>
                        <textarea class="w-full border border-blue-200 rounded-lg p-3 bg-blue-50 h-24" placeholder="å¦‚æœæˆ‘æ˜¯ç®¡ç†è€…ï¼Œæˆ‘ä¼šæ€ä¹ˆåšï¼Ÿ" name="entry.1729297281" required></textarea>
                    </div>

                    <div class="mb-6">
                        <label class="block text-gray-700 font-bold mb-2">è”ç³»æ–¹å¼</label>
                        <input type="text" class="w-full border rounded-lg p-3 bg-gray-50" placeholder="æ‰‹æœºå·/å¾®ä¿¡å· (å¯é€‰)" name="entry.1784523966">
                    </div>

                    <div class="flex justify-between items-center">
                        <iframe name="no-target" id="no-target" style="display:none;"></iframe>
                        <button type="submit" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 shadow-md">æäº¤å®¡æ ¸</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="view-admin" class="hidden">
            <div class="bg-white rounded-xl shadow-md overflow-hidden">
                <div class="p-6 border-b border-gray-200 flex justify-between items-center bg-gray-50">
                    <h2 class="text-xl font-bold text-gray-800">ğŸ“‹ å·¥ä½œå°è´¦ä¸è·Ÿè¿›</h2>
                    <div class="flex space-x-2">
                        <button class="bg-white border border-gray-300 px-3 py-1 rounded text-sm">å¯¼å‡ºå‘¨æŠ¥</button>
                        <button class="bg-blue-600 text-white px-3 py-1 rounded text-sm">æ–°å»ºä»»åŠ¡</button>
                    </div>
                </div>
                
                <table class="min-w-full text-left text-sm">
                    <thead class="bg-gray-100 text-gray-600 uppercase">
                        <tr>
                            <th class="px-6 py-3">ID</th>
                            <th class="px-6 py-3">åˆ†ç±»</th>
                            <th class="px-6 py-3">ææ¡ˆå†…å®¹</th>
                            <th class="px-6 py-3">çŠ¶æ€/è¿›åº¦</th>
                            <th class="px-6 py-3">è´£ä»»äºº</th>
                            <th class="px-6 py-3">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200" id="admin-table">
                        </tbody>
                </table>
            </div>
        </div>

    </div>

    <script>
        // æ¨¡æ‹Ÿæ•°æ®åº“æ•°æ® (ä½ å¯ä»¥é€šè¿‡ä¿®æ”¹è¿™é‡Œçš„å†…å®¹ï¼Œæ¥æ§åˆ¶å…¬ç¤ºåŒºæ˜¾ç¤ºçš„é¡¹ç›®)
        const data = [
            {
                id: "P-2023001",
                category: "åå‹¤ä¿éšœ",
                title: "å›¾ä¹¦é¦†ä¸‰æ¥¼è¥¿ä¾§ç©ºè°ƒåˆ¶å†·æ•ˆæœå·®",
                status: "processing", // pending, accepted, processing, completed, rejected
                progress: 60,
                location: "å›¾ä¹¦é¦†",
                solution: "å»ºè®®æ¸…æ´—æ»¤ç½‘æˆ–åŠ æ°Ÿ",
                reply: "å·²è”ç³»ç»´ä¿å•ä½ï¼Œé¢„è®¡å‘¨äº”å‰å®Œæˆæ¸…æ´—ã€‚",
                groupLink: "#",
                likes: 45
            },
            {
                id: "P-2023002",
                category: "æ•™å­¦æ•™åŠ¡",
                title: "å»ºè®®å»¶é•¿æœŸæœ«å‘¨è‡ªä¹ å®¤å¼€æ”¾æ—¶é—´",
                status: "completed",
                progress: 100,
                location: "å…¨æ ¡",
                solution: "é€šå®µå¼€æ”¾",
                reply: "ç»åè°ƒï¼Œè€ƒå‰ä¸¤å‘¨Aæ¥¼å¼€æ”¾è‡³24:00ã€‚",
                groupLink: "#",
                likes: 128
            },
            {
                id: "P-2023003",
                category: "ç”Ÿæ´»æƒç›Š",
                title: "è¦æ±‚ç»™æ¯é—´å®¿èˆå®‰è£…ç§äººæ´—è¡£æœº",
                status: "rejected",
                progress: 0,
                location: "å®¿èˆåŒº",
                solution: "å­¦æ ¡å‡ºèµ„è´­ä¹°",
                reply: "é©³å›ï¼šå—é™äºå®¿èˆæ°´ç”µçº¿è·¯è´Ÿè·åŠæ’æ±¡ç®¡é“è®¾è®¡ï¼Œæ— æ³•å®‰è£…ã€‚å»ºè®®ä½¿ç”¨å…¬å…±æ´—è¡£æˆ¿ã€‚",
                groupLink: "",
                likes: 12
            },
            {
                id: "P-2023004",
                category: "æ´»åŠ¨å»ºè®®",
                title: "è‰åœ°éŸ³ä¹èŠ‚åœºåœ°ç”³è¯·",
                status: "accepted",
                progress: 20,
                location: "å—æ“åœº",
                solution: "éœ€è§£å†³å™ªéŸ³å®¡æ‰¹",
                reply: "å·²ç«‹é¡¹ï¼Œæ­£åœ¨å¯¹æ¥ä¿å«å¤„å®¡æ‰¹ã€‚",
                groupLink: "#",
                likes: 8
            }
        ];

        // æ¸²æŸ“å‡½æ•°
        function render() {
            const publicContainer = document.getElementById('public-cards');
            const adminContainer = document.getElementById('admin-table');
            
            publicContainer.innerHTML = '';
            adminContainer.innerHTML = '';

            data.forEach(item => {
                // 1. æ¸²æŸ“ä¸­å°å¡ç‰‡
                let statusBadge = '';
                let progressBarColor = 'bg-blue-600';
                let cardBorder = '';
                
                if(item.status === 'completed') {
                    statusBadge = '<span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded">âœ… å·²è§£å†³</span>';
                    progressBarColor = 'bg-green-500';
                    cardBorder = 'border-green-500';
                } else if (item.status === 'processing') {
                    statusBadge = '<span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">ğŸ”„ æ¨è¿›ä¸­</span>';
                } else if (item.status === 'rejected') {
                    statusBadge = '<span class="bg-red-100 text-red-800 text-xs px-2 py-1 rounded">âŒ æœªé‡‡çº³</span>';
                    progressBarColor = 'bg-red-500';
                    cardBorder = 'border-red-400 opacity-75';
                } else {
                    statusBadge = '<span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded">â³ å¾…ç«‹é¡¹</span>';
                    progressBarColor = 'bg-yellow-500';
                }

                // ç¤¾ç¾¤é“¾æ¥æŒ‰é’®é€»è¾‘
                const groupBtn = item.groupLink && item.status !== 'rejected' && item.status !== 'completed' 
                    ? `<button class="text-xs flex items-center text-blue-600 font-bold hover:underline"><i class="fa-brands fa-weixin mr-1"></i> è¿›ç¾¤è·Ÿè¿›</button>` 
                    : '';

                const publicCard = `
                    <div class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition border-l-4 ${cardBorder || 'border-blue-500'}">
                        <div class="flex justify-between items-start mb-3">
                            <span class="text-xs text-gray-500 font-mono">${item.id}</span>
                            ${statusBadge}
                        </div>
                        <h3 class="font-bold text-lg text-gray-800 mb-2">${item.title}</h3>
                        <div class="text-sm text-gray-600 mb-4">
                            <i class="fa-solid fa-location-dot mr-1"></i> ${item.location}
                        </div>
                        
                        <div class="mb-4">
                            <div class="flex justify-between text-xs text-gray-500 mb-1">
                                <span>è¿›åº¦è¿½è¸ª</span>
                                <span>${item.progress}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="h-2 rounded-full ${progressBarColor}" style="width: ${item.progress}%"></div>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-3 rounded text-sm text-gray-700 mb-3 text-xs">
                            <span class="font-bold">å®˜æ–¹å›å¤ï¼š</span> ${item.reply || 'æš‚æ— æœ€æ–°å›å¤'}
                        </div>

                        <div class="flex justify-between items-center pt-2 border-t border-gray-100">
                            <div class="flex space-x-3 text-gray-500 text-sm">
                                <span class="cursor-pointer hover:text-blue-600"><i class="fa-regular fa-thumbs-up"></i> ${item.likes} é™„è®®</span>
                            </div>
                            ${groupBtn}
                        </div>
                    </div>
                `;
                publicContainer.innerHTML += publicCard;

                // 2. æ¸²æŸ“åå°è¡¨æ ¼è¡Œ
                const adminRow = `
                    <tr class="hover:bg-gray-50 transition">
                        <td class="px-6 py-4 font-mono text-gray-500">${item.id}</td>
                        <td class="px-6 py-4"><span class="px-2 py-1 bg-gray-100 rounded text-xs">${item.category}</span></td>
                        <td class="px-6 py-4 font-medium text-gray-900">${item.title}</td>
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <span class="w-2 h-2 rounded-full ${item.status === 'processing' ? 'bg-blue-500' : (item.status === 'completed' ? 'bg-green-500' : 'bg-red-500')} mr-2"></span>
                                ${item.status}
                            </div>
                        </td>
                        <td class="px-6 py-4 text-gray-500">æƒç›Šéƒ¨-å¼ ä¸‰</td>
                        <td class="px-6 py-4">
                            <button class="text-blue-600 hover:text-blue-900 text-xs font-bold mr-2">æ›´æ–°è¿›åº¦</button>
                            <button class="text-red-600 hover:text-red-900 text-xs">é©³å›</button>
                        </td>
                    </tr>
                `;
                adminContainer.innerHTML += adminRow;
            });
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µé€»è¾‘
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰è§†å›¾
            ['public', 'submit', 'admin'].forEach(view => {
                document.getElementById('view-' + view).classList.add('hidden');
                document.getElementById('btn-' + view).classList.remove('active-tab', 'text-blue-600');
                document.getElementById('btn-' + view).classList.add('text-gray-500');
            });

            // æ˜¾ç¤ºé€‰ä¸­è§†å›¾
            document.getElementById('view-' + tabName).classList.remove('hidden');
            
            // æ ·å¼æ¿€æ´»
            const btn = document.getElementById('btn-' + tabName);
            btn.classList.add('active-tab');
            btn.classList.remove('text-gray-500');
        }

        // åˆå§‹åŒ–
        render();

        // ********** æ ¸å¿ƒæäº¤é€»è¾‘ **********
        document.getElementById('submission-form').addEventListener('submit', function(e) {
            // é˜»æ­¢é»˜è®¤çš„è¡¨å•æäº¤
            e.preventDefault();

            // æ‰‹åŠ¨æäº¤è¡¨å•åˆ° Google Forms
            fetch(this.action, {
                method: this.method,
                body: new FormData(this),
                mode: 'no-cors'
            }).then(() => {
                // æäº¤æˆåŠŸåçš„åé¦ˆå’Œæ¸…ç©º
                alert('ğŸ‰ ææ¡ˆæäº¤æˆåŠŸï¼æ‚¨çš„æ„è§å·²å‘é€è‡³å­¦ç”Ÿä¼šæ•°æ®åå°ã€‚è¯·ç­‰å¾…å®¡æ ¸å’Œå…¬ç¤ºã€‚');
                this.reset(); // æ¸…ç©ºè¡¨å•å†…å®¹
                switchTab('public'); // è‡ªåŠ¨åˆ‡æ¢å›å…¬ç¤ºé¡µé¢
            }).catch(error => {
                // æäº¤å¤±è´¥çš„åé¦ˆ
                alert('âŒ æäº¤å¤±è´¥ï¼šè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–è”ç³»æŠ€æœ¯æ”¯æŒã€‚');
                console.error('Submission Error:', error);
            });
        });
    </script>
</body>
</html>
